{% comment %}
  Address Autocomplete App Embed Block
  This block is what makes the extension appear in App Embeds
  It loads the JavaScript and CSS on all pages where customer accounts are accessible
{% endcomment %}

{% schema %}
{
  "name": "Address Autocomplete",
  "target": "body",
  "settings": [
    {
      "type": "checkbox",
      "id": "enabled",
      "label": "Enable address autocomplete",
      "default": true
    },
    {
      "type": "paragraph",
      "content": "Automatically suggests addresses as customers type in address forms. Works on customer profile pages and checkout."
    }
  ]
}
{% endschema %}

{% if block.settings.enabled %}
  {%- comment -%} Load CSS {%- endcomment -%}
  {{ 'address-autocomplete.css' | asset_url | stylesheet_tag }}
  
  {%- comment -%} Load JavaScript {%- endcomment -%}
  <script src="{{ 'address-autocomplete.js' | asset_url }}" defer></script>
  
  {%- comment -%} Configuration {%- endcomment -%}
  {%- assign app_url = shop.metafields.custom.app_url.value -%}
  <script>
    window.addEventListener('DOMContentLoaded', function() {
      if (window.AddressAutocomplete && window.AddressAutocomplete.config) {
        {% if app_url %}
        // Configure API endpoint with app URL from metafield
        window.AddressAutocomplete.config.apiEndpoint = '{{ app_url }}/api/address-autocomplete/search?shop={{ shop.permanent_domain }}';
        window.AddressAutocomplete.config.shop = '{{ shop.permanent_domain }}';
        window.AddressAutocomplete.config.enabled = true;
        
        console.log('[Address Autocomplete] Configured with app URL:', '{{ app_url }}');
        {% else %}
        console.error('[Address Autocomplete] App URL metafield not set. Please configure shop.metafields.custom.app_url');
        {% endif %}
      }
    });
  </script>
{% endif %}

